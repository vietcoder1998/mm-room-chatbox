<!DOCTYPE html>
<html>
  <style></style>
  <div class="container">
    <button onclick="get_room()">rooms</button>
    <section></section>
    <main id="root"></main>
    <textarea id="msg" placeholder="... Press something" rows="4"> </textarea>
    <button onclick="addMsg()">Send</button>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io.connect('http://localhost:3100')
    const root = document.getElementById('root')
    const contentMsg = document.getElementById('msg')

    socket.on('connect', () => {
      console.log('welcome')
    })

    const get_room = function () {
      socket.emit('getRoom', '1')
    }

    const addMsg = function () {
      const msg = { id: '1', content: contentMsg.value }
      socket.emit('addMsg', msg, '1')
    }

    socket.on('receiveMsg', (response) => {
      const { data } = response
      console.log(data)
      renderMsg(data.msgs)
    })

    socket.on('receiveRoom', (response) => {
      const { data } = response
      console.log(data)
      renderMsg(data.msgs)
    })

    function renderMsg(msgs) {
      root.innerHTML = ''

      msgs.forEach((msg) => {
        const { id, content } = msg
        const element = document.createElement('button')
        element.innerHTML = msg.content
        element.id = msg.id

        root.append(element)
      })
    }
  </script>
</html>
